<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= product.name %> | Emera Luxury Atelier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        .font-serif { font-family: 'Playfair Display', serif; }
        
        /* Interactive Zoom */
        .zoom-container { position: relative; overflow: hidden; cursor: crosshair; background: #f9f8f6; }
        .zoom-img { transition: transform 0.1s ease-out; transform-origin: center center; }
        
        /* Star Rating */
        .star { color: #e5e7eb; font-size: 11px; }
        .star.filled { color: #022c22; }

        /* Stock Status */
        .stock-pill { font-size: 9px; font-weight: 700; padding: 8px 16px; text-transform: uppercase; letter-spacing: 0.15em; display: inline-block; }
        .stock-in { color: #166534; background: #f0fdf4; border: 1px solid #dcfce7; }
        .stock-low { color: #9a3412; background: #fff7ed; border: 1px solid #ffedd5; }
        .stock-out { color: #991b1b; background: #fef2f2; border: 1px solid #fee2e2; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-reveal { animation: slideUp 0.8s cubic-bezier(0.2, 1, 0.3, 1) forwards; }
        
        .swatch-ring { ring: 1px offset 2px; ring-color: #022c22; border-color: #022c22; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        emera: { 50: '#fafaf9', 700: '#15803d', 900: '#14532d', 950: '#022c22' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white text-gray-900">

    <!-- Navigation (Assuming shared partial or identical structure) -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 z-50 bg-emera-950 py-5 transition-all duration-500">
        <div class="max-w-[1440px] mx-auto px-6 lg:px-12 flex justify-between items-center text-white">
            <div class="flex space-x-12 items-center">
                <a href="/" class="text-[10px] uppercase tracking-[0.3em] font-medium hover:opacity-60 transition-opacity">Home</a>
                <a href="/products" class="text-[10px] uppercase tracking-[0.3em] font-medium hover:opacity-60 transition-opacity">Collections</a>
            </div>
            <a href="/" class="text-3xl font-serif tracking-tighter hover:opacity-90 transition-opacity">EMERA</a>
            <div class="flex space-x-8 items-center">
                <div class="relative cursor-pointer hover:opacity-60 transition-opacity">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                    <span id="cart-count-badge" class="absolute -top-2 -right-2 bg-white text-emera-950 text-[8px] w-4 h-4 rounded-full flex items-center justify-center font-bold">0</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="h-24 bg-emera-950"></div>

    <main class="max-w-[1440px] mx-auto px-6 lg:px-12 py-12 lg:py-20">
        <!-- Breadcrumbs -->
        <nav class="text-[9px] uppercase tracking-[0.4em] text-gray-400 mb-12 flex items-center space-x-4">
            <a href="/" class="hover:text-black transition-colors">Home</a>
            <span class="opacity-30">/</span>
            <a href="/products?category=<%= product.category?._id %>" class="hover:text-black transition-colors">
            <%= product.category?.name || 'Products' %>
            </a>

            <span class="opacity-30">/</span>
            <span class="text-black font-bold tracking-widest"><%= product.name %></span>
        </nav>

        <div class="flex flex-col lg:flex-row gap-16 lg:gap-24 items-start">
            <!-- Left: Gallery -->
            <div class="lg:w-3/5 flex flex-col-reverse lg:flex-row gap-6 w-full">
                <!-- Thumbnails -->
        <div class="flex lg:flex-col gap-4 overflow-x-auto lg:overflow-visible no-scrollbar pb-4 lg:pb-0">
        <% product.productImage.forEach((img, i) => { %>
            <button 
            onclick="changeActiveImage(<%= i %>)"
            class="thumb-btn flex-shrink-0 w-20 h-24 lg:w-24 lg:h-32 border border-stone-100 overflow-hidden transition-all duration-300
            <%= i === 0 ? 'ring-1 ring-emera-950 opacity-100' : 'opacity-40 hover:opacity-100' %>">

            <img 
                src="<%= img.url %>" 
                alt="Thumbnail <%= i + 1 %>"
                class="w-full h-full object-cover"
            />
            </button>
        <% }) %>
        </div>


                <!-- Main Display -->
                <div class="flex-1 aspect-[4/5] relative zoom-container group shadow-sm" id="main-zoom-area">
                    <img 
                    id="main-img" 
                    src="<%= product.productImage?.[0]?.url || '/images/placeholder.png' %>" 
                    class="zoom-img w-full h-full object-cover">

                    <div class="absolute top-6 right-6 pointer-events-none">
                        <% if (product.quantity > 0 && product.quantity < 5) { %>
                            <span class="bg-white/90 text-emera-950 text-[9px] font-bold px-4 py-2 uppercase tracking-widest shadow-sm">Limited Stock</span>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Right: Product Information -->
            <div class="lg:w-2/5 space-y-12 animate-reveal w-full">
                <div class="space-y-6">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4">
                        <h1 class="text-4xl lg:text-5xl font-serif text-gray-900 leading-tight">
                            <%= product.name.split(' ').slice(0, -1).join(' ') %> <br>
                            <span class="italic font-light"><%= product.name.split(' ').slice(-1) %></span>
                        </h1>
                        
                        <div id="stock-status-pill">
                            <% if (product.quantity === 0) { %>
                                <div class="stock-pill stock-out">Sold Out</div>
                            <% } else if (product.quantity < 5) { %>
                                <div class="stock-pill stock-low">Only <%= product.quantity %> Left</div>
                            <% } else { %>
                                <div class="stock-pill stock-in">In Stock</div>
                            <% } %>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between border-b border-stone-50 pb-8">
                        <div class="flex flex-col">
                            <div class="flex items-center space-x-4">
                                <p class="text-3xl font-medium text-gray-900">₹<%= product.salePrice.toLocaleString() %></p>
                                <% if (product.salePrice < product.regularPrice) { %>
                                    <p class="text-base text-gray-400 line-through font-light">₹<%= product.regularPrice.toLocaleString() %></p>
                                    <span class="text-[9px] bg-emera-700 text-white px-2 py-1 uppercase font-bold tracking-tighter">
                                        Save <%= Math.round((1 - product.salePrice/product.regularPrice) * 100) %>%
                                    </span>
                                <% } %>
                            </div>
                            <span class="text-[9px] text-emera-700 font-bold uppercase tracking-[0.2em] mt-3 italic">Certified Premium Product</span>
                        </div>
                        
                        <div class="text-right">
                            <div class="flex gap-1 justify-end">
                                <span class="star filled">★</span><span class="star filled">★</span><span class="star filled">★</span><span class="star filled">★</span><span class="star filled">★</span>
                            </div>
                            <p class="text-[9px] text-gray-400 uppercase tracking-widest font-bold mt-2">Customer Rating</p>
                        </div>
                    </div>
                </div>

                <!-- Offers Card -->
                <div class="bg-stone-50 border border-stone-100 p-8 space-y-4">
                    <div class="flex items-center space-x-3 text-emera-950">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path></svg>
                        <span class="text-[10px] uppercase tracking-[0.3em] font-bold">Special Offer</span>
                    </div>
                    <p class="text-[11px] text-gray-500 font-light leading-relaxed uppercase tracking-widest">
                        Complimentary care kit <span class="text-emera-950 font-bold"> included with purchases </span> over ₹50,000.
                    </p>
                </div>

                <!-- Description -->
                <div class="space-y-4">
                    <h4 class="text-[10px] uppercase tracking-widest font-bold text-gray-400">Product Description</h4>
                    <p class="text-[13px] text-gray-600 leading-relaxed font-light tracking-wide">
                        <%= product.description %>
                    </p>
                </div>

                <!-- Actions -->
                <div class="space-y-10 pt-4">
                    <div class="space-y-4">
                        <label class="text-[10px] uppercase tracking-widest font-bold text-gray-400">Available Colors</label>
                        <div class="flex gap-4">
                            <button onclick="selectShade(this)" class="shade-btn w-10 h-10 rounded-full bg-[#8B4513] border-2 border-transparent swatch-ring"></button>
                            <button onclick="selectShade(this)" class="shade-btn w-10 h-10 rounded-full bg-[#1A1A1A] border-2 border-transparent"></button>
                            <button onclick="selectShade(this)" class="shade-btn w-10 h-10 rounded-full bg-[#022c22] border-2 border-transparent"></button>
                        </div>
                    </div>

                    <div class="flex flex-col gap-6">
                        
                    <% if (product.quantity === 0) { %>

                    <!-- OUT OF STOCK -->
                    <button
                        disabled
                        class="w-full bg-stone-100 text-stone-300 py-6 text-[10px] uppercase tracking-[0.5em] font-bold cursor-not-allowed">
                        Out of Stock
                    </button>

                    <% } else if (!user) { %>

                    <!-- IN STOCK, USER NOT LOGGED IN -->
                    <a
                        href="/login"
                        class="block text-center w-full bg-emera-950 text-white py-6 text-[10px] uppercase tracking-[0.5em] font-bold hover:bg-black transition-all">
                        Add to cart
                    </a>

                    <% } else { %>

                    <!-- IN STOCK, USER LOGGED IN -->
                    <button
                        id="add-btn"
                        onclick="addToCart('<%= product._id %>')"
                        class="w-full bg-emera-950 text-white py-6 text-[10px] uppercase tracking-[0.5em] font-bold hover:bg-black transition-all">
                        Add to cart
                    </button>

                    <% } %>




                        <div class="flex items-center justify-center space-x-6 text-[9px] uppercase tracking-widest font-bold text-gray-400">
                            <span class="flex items-center"><svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"></path></svg> Global Shipping</span>
                            <span class="flex items-center"><svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"></path></svg> 14-Day Returns</span>
                        </div>
                    </div>
                </div>

                <!-- Specifications Accordion -->
                <div class="border-t border-stone-100 pt-8">
                    <details class="group" open>
                        <summary class="flex justify-between items-center cursor-pointer list-none text-[10px] uppercase tracking-[0.4em] font-bold text-gray-900">
                            <span>Product Specifications</span>
                            <span class="group-open:rotate-45 transition-transform duration-300 text-xl font-light text-stone-300">+</span>
                        </summary>
                        <div class="pt-10 grid grid-cols-1 sm:grid-cols-2 gap-y-8 gap-x-12 text-[11px] text-gray-400 uppercase tracking-widest font-medium">
                            <div class="border-l border-stone-100 pl-6">
                                <p class="text-gray-900 mb-1">Materia</p>
                                <p class="font-light">100% Full-grain Calfskin</p>
                            </div>
                            <div class="border-l border-stone-100 pl-6">
                                <p class="text-gray-900 mb-1">Hardware</p>
                                <p class="font-light">24k Gold-Finished Palladium</p>
                            </div>
                            <div class="border-l border-stone-100 pl-6">
                                <p class="text-gray-900 mb-1">Architecture</p>
                                <p class="font-light">Structured with Suede Lining</p>
                            </div>
                            <div class="border-l border-stone-100 pl-6">
                                <p class="text-gray-900 mb-1">Origin</p>
                                <p class="font-light">Handcrafted in Florence</p>
                            </div>
                        </div>
                    </details>
                </div>
            </div>
        </div>

        <!-- Related Recommendations -->
        <% if (relatedProducts && relatedProducts.length > 0) { %>
        <section class="mt-40 border-t border-stone-50 pt-32">
            <div class="flex justify-between items-end mb-20">
                <div class="space-y-4">
                    <span class="text-[10px] uppercase tracking-[0.5em] font-bold text-gray-400 block">You May Also Like</span>
                    <h2 class="text-4xl font-serif">Related Products</h2>
                </div>
                <a href="/products" class="text-[10px] uppercase tracking-widest border-b border-gray-900 pb-2 font-bold hover:text-emera-700 transition-colors">Browse Archive</a>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-12 lg:gap-16">
                <% relatedProducts.forEach(rp => { %>
                    <a href="/products/<%= rp._id %>" class="block group space-y-6">
                        <div class="aspect-[4/5] bg-stone-50 overflow-hidden relative">
                           <img 
                            src="<%= rp.productImage?.[0]?.url || '/images/placeholder.png' %>" 
                            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000">

                        </div>
                        <div class="space-y-2">
                            <h3 class="text-sm font-serif group-hover:text-emera-950 transition-colors"><%= rp.name %></h3>
                            <div class="flex justify-between items-center">
                                <p class="text-[10px] font-bold tracking-widest">₹<%= rp.salePrice.toLocaleString() %></p>
                                <span class="text-[9px] uppercase tracking-widest text-gray-400">View Details</span>
                            </div>
                        </div>
                    </a>
                <% }) %>
            </div>
        </section>
        <% } %>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-stone-100 pt-32 pb-16">
  <div class="max-w-[1440px] mx-auto px-6 lg:px-12 grid grid-cols-1 md:grid-cols-4 gap-24 mb-24">

    <!-- BRAND -->
    <div class="col-span-1">
      <h2 class="text-4xl font-serif mb-10 tracking-tighter">EMERA</h2>
      <p class="text-[11px] text-stone-400 leading-relaxed max-w-xs font-light tracking-wide">
        Premium leather bags designed for everyday elegance. Crafted with quality materials and modern design standards.
      </p>
    </div>

    <!-- SHOP -->
    <div>
      <h4 class="text-[10px] uppercase tracking-[0.4em] font-bold mb-10 text-gray-900">
        Shop
      </h4>
      <ul class="space-y-6 text-[10px] uppercase tracking-[0.2em] text-stone-400 font-bold">
        <li>
          <a href="/products" class="hover:text-emera-950 transition-colors">
            All Products
          </a>
        </li>
        <li>
          <a href="/products?featured=true" class="hover:text-emera-950 transition-colors">
            Featured Items
          </a>
        </li>
      </ul>
    </div>

    <!-- COMPANY -->
    <div>
      <h4 class="text-[10px] uppercase tracking-[0.4em] font-bold mb-10 text-gray-900">
        Company
      </h4>
      <ul class="space-y-6 text-[10px] uppercase tracking-[0.2em] text-stone-400 font-bold">
        <li>
          <a href="/about" class="hover:text-emera-950 transition-colors">
            About Us
          </a>
        </li>
        <li>
          <a href="/contact" class="hover:text-emera-950 transition-colors">
            Contact
          </a>
        </li>
      </ul>
    </div>

    <!-- NEWSLETTER -->
    <div>
      <h4 class="text-[10px] uppercase tracking-[0.4em] font-bold mb-10 text-gray-900">
        Newsletter
      </h4>
      <p class="text-[11px] text-stone-400 mb-6 leading-relaxed">
        Subscribe to receive updates on new arrivals, offers, and promotions.
      </p>
      <form class="flex border-b border-stone-200 pb-3 group focus-within:border-emera-950 transition-colors">
        <input
          type="email"
          placeholder="Enter your email"
          class="flex-1 bg-transparent border-none py-2 text-[10px] tracking-widest outline-none"
        />
        <button
          type="submit"
          class="text-[10px] uppercase tracking-widest font-bold opacity-60 hover:opacity-100 transition"
        >
          Subscribe
        </button>
      </form>
    </div>

  </div>

  <!-- COPYRIGHT -->
  <div class="max-w-[1440px] mx-auto px-6 lg:px-12 pt-12 border-t border-stone-100 text-[9px] uppercase tracking-[0.3em] text-stone-400 text-center font-bold">
    © 2025 EMERA Pvt. Ltd. India. All rights reserved.
  </div>
</footer>


<script>
  const PRODUCT_GALLERY = <%- JSON.stringify(product.productImage) %>;
  const PRODUCT_BLOCKED = <%= !!product.isBlocked %>;

  if (PRODUCT_BLOCKED) {
    window.location.href = '/products';
  }

  function changeActiveImage(idx) {
    if (!PRODUCT_GALLERY[idx]) return;

    const mainImg = document.getElementById('main-img');
    mainImg.src = PRODUCT_GALLERY[idx].url;

    document.querySelectorAll('.thumb-btn').forEach((btn, i) => {
      btn.classList.toggle('ring-1', i === idx);
      btn.classList.toggle('ring-emera-950', i === idx);
      btn.classList.toggle('opacity-100', i === idx);
      btn.classList.toggle('opacity-40', i !== idx);
    });
  }

  // ZOOM ENGINE
  const zoomArea = document.getElementById('main-zoom-area');
  const zoomImg = document.getElementById('main-img');

  if (zoomArea && zoomImg) {
    zoomArea.addEventListener('mousemove', (e) => {
      const { left, top, width, height } = zoomArea.getBoundingClientRect();
      const x = ((e.clientX - left) / width) * 100;
      const y = ((e.clientY - top) / height) * 100;
      zoomImg.style.transformOrigin = `${x}% ${y}%`;
      zoomImg.style.transform = 'scale(2.2)';
    });

    zoomArea.addEventListener('mouseleave', () => {
      zoomImg.style.transform = 'scale(1)';
    });
  }

  function selectShade(el) {
    document.querySelectorAll('.shade-btn').forEach(btn =>
      btn.classList.remove('swatch-ring')
    );
    el.classList.add('swatch-ring');
  }

  function addToCart(productId) {
    fetch("/add-to-cart", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ productId })
    })
      .then(res => {
        if (res.redirected) {
          window.location.href = res.url;
          return;
        }
        return res.json();
      })
      .then(data => {
        if (data?.success) {
          const badge = document.getElementById("cart-count-badge");
          if (badge && data.cartCount !== undefined) {
            badge.textContent = data.cartCount;
            badge.classList.remove("hidden");

            // small animation
            badge.classList.add("scale-125");
            setTimeout(() => badge.classList.remove("scale-125"), 300);
          }
        }
      })
      .catch(console.error);
  }
</script>



</body>
</html>